<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‰¹å¾å€¼ä¸ç‰¹å¾å‘é‡å‡ ä½•å¯è§†åŒ–</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 1600px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(90deg, #1a2980 0%, #26d0ce 100%);
            color: white;
            padding: 25px 40px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 8px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            font-weight: 300;
        }
        
        .main-content {
            display: flex;
            padding: 30px;
            gap: 30px;
        }
        
        .left-panel {
            flex: 1.2;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        
        .right-panel {
            flex: 2;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        
        .control-panel {
            background-color: #f8fafc;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .matrix-input {
            margin-bottom: 25px;
        }
        
        .matrix-input h3 {
            margin-bottom: 15px;
            color: #1a2980;
            font-size: 1.3rem;
            border-bottom: 2px solid #26d0ce;
            padding-bottom: 8px;
        }
        
        .matrix-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            max-width: 220px;
            margin: 0 auto 20px;
        }
        
        .matrix-input input {
            width: 100%;
            padding: 14px;
            font-size: 1.3rem;
            text-align: center;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .matrix-input input:focus {
            border-color: #26d0ce;
            box-shadow: 0 0 0 3px rgba(38, 208, 206, 0.2);
            outline: none;
        }
        
        .matrix-input input.error {
            border-color: #e53e3e;
            background-color: #fff5f5;
        }
        
        .error-message {
            color: #e53e3e;
            font-size: 0.9rem;
            margin-top: 8px;
            text-align: center;
            min-height: 20px;
        }
        
        .input-hint {
            color: #718096;
            font-size: 0.9rem;
            text-align: center;
            margin-top: 10px;
        }
        
        .buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        button {
            flex: 1;
            padding: 16px;
            font-size: 1.1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        #generate-btn {
            background: linear-gradient(90deg, #1a2980 0%, #26d0ce 100%);
            color: white;
        }
        
        #generate-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 7px 14px rgba(26, 41, 128, 0.2);
        }
        
        #generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        #reset-btn {
            background-color: #e2e8f0;
            color: #4a5568;
        }
        
        #reset-btn:hover {
            background-color: #cbd5e0;
            transform: translateY(-2px);
        }
        
        .eigen-info {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .eigen-info h3 {
            margin-bottom: 15px;
            color: #1a2980;
            font-size: 1.3rem;
        }
        
        .eigen-values, .eigen-vectors {
            margin-bottom: 20px;
        }
        
        .eigen-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding: 12px;
            background-color: #f8fafc;
            border-radius: 8px;
        }
        
        .eigen-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 15px;
        }
        
        .color-red {
            background-color: #e53e3e;
        }
        
        .color-blue {
            background-color: #3182ce;
        }
        
        .flip-note {
            color: #d69e2e;
            font-weight: 600;
            background-color: #fffaf0;
            padding: 5px 10px;
            border-radius: 4px;
            margin-top: 10px;
            display: none;
        }
        
        .loading-indicator {
            display: none;
            text-align: center;
            color: #3182ce;
            font-weight: 500;
            margin: 10px 0;
        }
        
        .loading-indicator.active {
            display: block;
        }
        
        .auto-update-label {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
            color: #4a5568;
            font-size: 0.95rem;
        }
        
        .auto-update-label input {
            width: 18px;
            height: 18px;
        }
        
        .visualization-area {
            display: flex;
            flex-direction: column;
            gap: 30px;
            flex: 1;
        }
        
        .canvas-row {
            display: flex;
            gap: 30px;
            height: 350px;
        }
        
        .canvas-container {
            flex: 1;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            position: relative;
            height: 100%;
        }
        
        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }
        
        .canvas-title {
            position: absolute;
            top: 15px;
            left: 15px;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            color: #1a2980;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }
        
        .canvas-title.transform {
            left: auto;
            right: 15px;
        }
        
        .scale-info {
            position: absolute;
            bottom: 15px;
            left: 15px;
            background-color: rgba(255, 255, 255, 0.85);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            color: #4a5568;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .dynamic-explanation {
            background: linear-gradient(135deg, #f0f4ff 0%, #e6f7ff 100%);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #1a2980;
            flex: 0.8;
        }
        
        .dynamic-explanation h3 {
            margin-bottom: 15px;
            color: #1a2980;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .dynamic-explanation h3::before {
            content: "ğŸ’¡";
            font-size: 1.5rem;
        }
        
        .dynamic-content {
            line-height: 1.6;
            max-height: 300px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .dynamic-content p {
            margin-bottom: 15px;
        }
        
        .highlight {
            background-color: #fffacd;
            padding: 3px 6px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        .value-highlight {
            color: #1a2980;
            font-weight: 600;
            background-color: #e6f7ff;
            padding: 2px 6px;
            border-radius: 4px;
        }
        
        .math-explanation {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .math-explanation h3 {
            margin-bottom: 15px;
            color: #1a2980;
            font-size: 1.3rem;
        }
        
        .math-explanation p {
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .formula {
            font-family: 'Cambria Math', 'Times New Roman', serif;
            font-size: 1.2rem;
            background-color: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin: 15px 0;
            border-left: 4px solid #26d0ce;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #718096;
            font-size: 0.9rem;
            border-top: 1px solid #e2e8f0;
            margin-top: 20px;
        }
        
        @media (max-width: 1400px) {
            .main-content {
                flex-direction: column;
            }
            
            .canvas-row {
                height: 300px;
            }
            
            .left-panel, .right-panel {
                width: 100%;
            }
        }
        
        @media (max-width: 768px) {
            .matrix-grid {
                max-width: 180px;
            }
            
            .matrix-input input {
                padding: 12px;
                font-size: 1.1rem;
            }
            
            .canvas-row {
                flex-direction: column;
                height: auto;
            }
            
            .canvas-container {
                height: 280px;
            }
            
            .dynamic-explanation {
                padding: 18px;
            }
        }
        
        .quick-matrix-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        
        .quick-matrix-btn {
            padding: 10px;
            background-color: #e6f7ff;
            border: 1px solid #b3e0ff;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            text-align: center;
            transition: all 0.2s;
        }
        
        .quick-matrix-btn:hover {
            background-color: #cceeff;
            transform: translateY(-2px);
        }
        
        .matrix-preset-title {
            text-align: center;
            margin-top: 20px;
            color: #4a5568;
            font-size: 0.9rem;
        }
        
        .zoom-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }
        
        .zoom-btn {
            padding: 8px 16px;
            background-color: #e2e8f0;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        
        .zoom-btn:hover {
            background-color: #cbd5e0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ç‰¹å¾å€¼ä¸ç‰¹å¾å‘é‡å‡ ä½•å¯è§†åŒ–</h1>
            <p class="subtitle">ç›´è§‚ç†è§£çº¿æ€§å˜æ¢ä¸­ä¿æŒæ–¹å‘ä¸å˜çš„å‘é‡</p>
        </header>
        
        <div class="main-content">
            <div class="left-panel">
                <div class="control-panel">
                    <div class="matrix-input">
                        <h3>è¾“å…¥ 2Ã—2 çŸ©é˜µ</h3>
                        <div class="matrix-grid">
                            <input type="text" id="a11" value="2" inputmode="decimal">
                            <input type="text" id="a12" value="1" inputmode="decimal">
                            <input type="text" id="a21" value="1" inputmode="decimal">
                            <input type="text" id="a22" value="2" inputmode="decimal">
                        </div>
                        <div class="error-message" id="matrix-error"></div>
                        <div class="input-hint">
                            æç¤ºï¼šè¾“å…¥æ•°å­—ï¼ˆæ”¯æŒå°æ•°å’Œè´Ÿæ•°ï¼Œå¦‚-1.5ï¼‰
                        </div>
                    </div>
                    
                    <div class="auto-update-label">
                        <input type="checkbox" id="auto-update" checked>
                        <label for="auto-update">å®æ—¶æ›´æ–°å¯è§†åŒ–</label>
                    </div>
                    
                    <div class="loading-indicator" id="loading-indicator">è®¡ç®—ä¸­...</div>
                    
                    <div class="buttons">
                        <button id="generate-btn" disabled>ç”Ÿæˆå˜æ¢</button>
                        <button id="reset-btn">é‡ç½®çŸ©é˜µ</button>
                    </div>
                    
                    <div class="matrix-preset-title">å¿«é€ŸçŸ©é˜µç¤ºä¾‹ï¼š</div>
                    <div class="quick-matrix-buttons">
                        <div class="quick-matrix-btn" data-matrix="2,1,1,2">å¯¹ç§°çŸ©é˜µ</div>
                        <div class="quick-matrix-btn" data-matrix="1,2,3,4">ä¸€èˆ¬çŸ©é˜µ</div>
                        <div class="quick-matrix-btn" data-matrix="0,-1,1,0">æ—‹è½¬çŸ©é˜µ</div>
                        <div class="quick-matrix-btn" data-matrix="2,0,0,0.5">ç¼©æ”¾çŸ©é˜µ</div>
                        <div class="quick-matrix-btn" data-matrix="1,0,0,-1">é•œåƒçŸ©é˜µ</div>
                        <div class="quick-matrix-btn" data-matrix="0.5,0,0,0.5">æ”¶ç¼©çŸ©é˜µ</div>
                    </div>
                    
                    <div class="zoom-controls">
                        <button class="zoom-btn" id="zoom-in">æ”¾å¤§å˜æ¢å›¾å½¢</button>
                        <button class="zoom-btn" id="zoom-out">ç¼©å°å˜æ¢å›¾å½¢</button>
                        <button class="zoom-btn" id="reset-zoom">é‡ç½®ç¼©æ”¾</button>
                    </div>
                </div>
                
                <div class="eigen-info">
                    <h3>ç‰¹å¾å€¼ä¸ç‰¹å¾å‘é‡</h3>
                    <div class="eigen-values">
                        <div class="eigen-item">
                            <div class="eigen-color color-red"></div>
                            <div>
                                <strong>ç‰¹å¾å€¼ Î»â‚:</strong> <span id="lambda1">3.00</span>
                            </div>
                        </div>
                        <div class="eigen-item">
                            <div class="eigen-color color-blue"></div>
                            <div>
                                <strong>ç‰¹å¾å€¼ Î»â‚‚:</strong> <span id="lambda2">1.00</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="eigen-vectors">
                        <div class="eigen-item">
                            <div class="eigen-color color-red"></div>
                            <div>
                                <strong>ç‰¹å¾å‘é‡ vâ‚:</strong> <span id="vector1">[0.707, 0.707]</span>
                            </div>
                        </div>
                        <div class="eigen-item">
                            <div class="eigen-color color-blue"></div>
                            <div>
                                <strong>ç‰¹å¾å‘é‡ vâ‚‚:</strong> <span id="vector2">[-0.707, 0.707]</span>
                            </div>
                        </div>
                    </div>
                    
                    <div id="flip-note1" class="flip-note">ç‰¹å¾å€¼ä¸ºè´Ÿï¼Œå˜æ¢åæ–¹å‘ç¿»è½¬</div>
                    <div id="flip-note2" class="flip-note">ç‰¹å¾å€¼ä¸ºè´Ÿï¼Œå˜æ¢åæ–¹å‘ç¿»è½¬</div>
                </div>
            </div>
            
            <div class="right-panel">
                <div class="visualization-area">
                    <div class="canvas-row">
                        <div class="canvas-container">
                            <div class="canvas-title">åŸå§‹å›¾å½¢ï¼šå•ä½åœ†ä¸ç½‘æ ¼</div>
                            <div class="scale-info">ç¼©æ”¾æ¯”ä¾‹: 1.0x</div>
                            <canvas id="original-canvas"></canvas>
                        </div>
                        
                        <div class="canvas-container">
                            <div class="canvas-title transform">å˜æ¢åå›¾å½¢ä¸ç‰¹å¾å‘é‡</div>
                            <div class="scale-info" id="transformed-scale-info">ç¼©æ”¾æ¯”ä¾‹: 1.0x</div>
                            <canvas id="transformed-canvas"></canvas>
                        </div>
                    </div>
                    
                    <div class="legend">
                        <div class="legend-item">
                            <div class="eigen-color color-red" style="margin-right: 8px;"></div>
                            <span>ç¬¬ä¸€ç‰¹å¾å‘é‡ (Î»â‚)</span>
                        </div>
                        <div class="legend-item">
                            <div class="eigen-color color-blue" style="margin-right: 8px;"></div>
                            <span>ç¬¬äºŒç‰¹å¾å‘é‡ (Î»â‚‚)</span>
                        </div>
                        <div class="legend-item">
                            <div style="width: 20px; height: 2px; background-color: #3498db; margin-right: 8px;"></div>
                            <span>å•ä½åœ†</span>
                        </div>
                        <div class="legend-item">
                            <div style="width: 20px; height: 2px; background-color: #2ecc71; margin-right: 8px;"></div>
                            <span>ç½‘æ ¼</span>
                        </div>
                        <div class="legend-item">
                            <div style="width: 20px; height: 0; border-top: 2px dashed #e53e3e; margin-right: 8px;"></div>
                            <span>å˜æ¢åå‘é‡</span>
                        </div>
                    </div>
                </div>
                
                <div class="dynamic-explanation">
                    <h3>å½“å‰çŸ©é˜µå˜æ¢åŠ¨æ€è§£é‡Š</h3>
                    <div class="dynamic-content" id="dynamic-explanation-content">
                        <p>å¯¹äºå½“å‰çŸ©é˜µ <span class="value-highlight" id="matrix-display">[[2, 1], [1, 2]]</span>ï¼š</p>
                        <p>çº¢è‰²ç‰¹å¾å‘é‡ <span class="highlight">vâ‚ = [0.707, 0.707]</span> å¯¹åº”çš„ç‰¹å¾å€¼ <span class="value-highlight">Î»â‚ = 3.00</span>ã€‚åœ¨çº¿æ€§å˜æ¢ä¸­ï¼Œæ²¿æ­¤æ–¹å‘çš„å‘é‡ä¿æŒæ–¹å‘ä¸å˜ï¼Œé•¿åº¦ç¼©æ”¾ä¸ºåŸæ¥çš„ <span class="value-highlight">3.00</span> å€ã€‚</p>
                        <p>è“è‰²ç‰¹å¾å‘é‡ <span class="highlight">vâ‚‚ = [-0.707, 0.707]</span> å¯¹åº”çš„ç‰¹å¾å€¼ <span class="value-highlight">Î»â‚‚ = 1.00</span>ã€‚æ²¿æ­¤æ–¹å‘çš„å‘é‡ä¿æŒæ–¹å‘ä¸å˜ï¼Œé•¿åº¦ç¼©æ”¾ä¸ºåŸæ¥çš„ <span class="value-highlight">1.00</span> å€ï¼ˆå³é•¿åº¦ä¸å˜ï¼‰ã€‚</p>
                        <p><span class="highlight">æ€»ç»“ï¼š</span>åœ¨è¿™ä¸ªå˜æ¢ä¸­ï¼Œä¸¤ä¸ªç‰¹å¾å‘é‡çš„æ–¹å‘å‡ä¿æŒä¸å˜ï¼Œçº¢è‰²å‘é‡æ–¹å‘è¢«æ‹‰ä¼¸3å€ï¼Œè“è‰²å‘é‡æ–¹å‘é•¿åº¦ä¸å˜ã€‚å˜æ¢å°†å•ä½åœ†æ‹‰ä¼¸ä¸ºæ¤­åœ†ï¼Œä¸»è½´æ²¿ç‰¹å¾å‘é‡æ–¹å‘ã€‚</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="math-explanation">
            <h3>æ•°å­¦è§£é‡Š</h3>
            <p>å¯¹äºç»™å®šçš„æ–¹é˜µ <strong>A</strong>ï¼Œå¦‚æœå­˜åœ¨éé›¶å‘é‡ <strong>v</strong> å’Œæ ‡é‡ <strong>Î»</strong>ï¼Œä½¿å¾—ä»¥ä¸‹æ–¹ç¨‹æˆç«‹ï¼š</p>
            <div class="formula">A Â· v = Î» Â· v</div>
            <p>é‚£ä¹ˆ <strong>v</strong> ç§°ä¸ºçŸ©é˜µ <strong>A</strong> çš„ç‰¹å¾å‘é‡ï¼Œ<strong>Î»</strong> ç§°ä¸ºå¯¹åº”çš„ç‰¹å¾å€¼ã€‚</p>
            <p>å‡ ä½•æ„ä¹‰ï¼šåœ¨çº¿æ€§å˜æ¢ <strong>A</strong> çš„ä½œç”¨ä¸‹ï¼Œç‰¹å¾å‘é‡ <strong>v</strong> çš„æ–¹å‘ä¿æŒä¸å˜ï¼ˆæˆ–åå‘ï¼‰ï¼Œä»…æŒ‰ç‰¹å¾å€¼ <strong>Î»</strong> çš„æ¯”ä¾‹è¿›è¡Œç¼©æ”¾ã€‚</p>
            <p>å½“ Î» > 0 æ—¶ï¼Œæ–¹å‘ä¸å˜ï¼›å½“ Î» < 0 æ—¶ï¼Œæ–¹å‘ç¿»è½¬ï¼›å½“ Î» = 0 æ—¶ï¼Œå‘é‡è¢«å‹ç¼©åˆ°åŸç‚¹ã€‚</p>
        </div>
        
        <div class="footer">
            <p>ç‰¹å¾å€¼ä¸ç‰¹å¾å‘é‡å‡ ä½•å¯è§†åŒ– | çº¿æ€§ä»£æ•°äº¤äº’å¼æ•™å­¦å·¥å…·</p>
        </div>
    </div>

    <script>
        // è·å–DOMå…ƒç´ 
        const originalCanvas = document.getElementById('original-canvas');
        const transformedCanvas = document.getElementById('transformed-canvas');
        const generateBtn = document.getElementById('generate-btn');
        const resetBtn = document.getElementById('reset-btn');
        const matrixInputs = {
            a11: document.getElementById('a11'),
            a12: document.getElementById('a12'),
            a21: document.getElementById('a21'),
            a22: document.getElementById('a22')
        };
        const matrixErrorEl = document.getElementById('matrix-error');
        const loadingIndicator = document.getElementById('loading-indicator');
        const autoUpdateCheckbox = document.getElementById('auto-update');
        const dynamicExplanationEl = document.getElementById('dynamic-explanation-content');
        const matrixDisplayEl = document.getElementById('matrix-display');
        const quickMatrixBtns = document.querySelectorAll('.quick-matrix-btn');
        const zoomInBtn = document.getElementById('zoom-in');
        const zoomOutBtn = document.getElementById('zoom-out');
        const resetZoomBtn = document.getElementById('reset-zoom');
        const transformedScaleInfo = document.getElementById('transformed-scale-info');
        
        // ç‰¹å¾å€¼æ˜¾ç¤ºå…ƒç´ 
        const lambda1El = document.getElementById('lambda1');
        const lambda2El = document.getElementById('lambda2');
        const vector1El = document.getElementById('vector1');
        const vector2El = document.getElementById('vector2');
        const flipNote1El = document.getElementById('flip-note1');
        const flipNote2El = document.getElementById('flip-note2');
        
        // è·å–Canvasä¸Šä¸‹æ–‡
        const originalCtx = originalCanvas.getContext('2d');
        const transformedCtx = transformedCanvas.getContext('2d');
        
        // è¾“å…¥éªŒè¯çŠ¶æ€
        let isValidInput = true;
        let validationTimeout = null;
        
        // ç¼©æ”¾æ§åˆ¶
        let transformedScale = 1.0;
        const MIN_SCALE = 0.1;
        const MAX_SCALE = 10.0;
        const SCALE_STEP = 0.2;
        
        // è®¾ç½®Canvaså°ºå¯¸
        function resizeCanvases() {
            const container = document.querySelector('.canvas-container');
            const width = container.clientWidth;
            const height = container.clientHeight;
            
            originalCanvas.width = width;
            originalCanvas.height = height;
            transformedCanvas.width = width;
            transformedCanvas.height = height;
            
            // é‡æ–°ç»˜åˆ¶
            drawOriginal();
            if (window.currentMatrix) {
                drawTransformed(window.currentMatrix);
            }
        }
        
        // åˆå§‹åŒ–çŸ©é˜µå€¼
        let currentMatrix = [[2, 1], [1, 2]];
        let eigenvalues = [3, 1];
        let eigenvectors = [[Math.SQRT1_2, Math.SQRT1_2], [-Math.SQRT1_2, Math.SQRT1_2]];
        
        // è®¡ç®—å˜æ¢åå›¾å½¢çš„æœ€å¤§èŒƒå›´
        function getTransformedRange(matrix) {
            let maxRange = 0;
            
            // æ£€æŸ¥å•ä½åœ†ä¸Šçš„ç‚¹
            const circlePoints = 100;
            for (let i = 0; i <= circlePoints; i++) {
                const angle = (i / circlePoints) * Math.PI * 2;
                const x = Math.cos(angle);
                const y = Math.sin(angle);
                
                // åº”ç”¨çŸ©é˜µå˜æ¢
                const tx = matrix[0][0] * x + matrix[0][1] * y;
                const ty = matrix[1][0] * x + matrix[1][1] * y;
                
                maxRange = Math.max(maxRange, Math.abs(tx), Math.abs(ty));
            }
            
            // æ£€æŸ¥æ­£æ–¹å½¢é¡¶ç‚¹
            const squarePoints = [
                [-0.5, -0.5],
                [0.5, -0.5],
                [0.5, 0.5],
                [-0.5, 0.5]
            ];
            
            squarePoints.forEach(([x, y]) => {
                // åº”ç”¨çŸ©é˜µå˜æ¢
                const tx = matrix[0][0] * x + matrix[0][1] * y;
                const ty = matrix[1][0] * x + matrix[1][1] * y;
                
                maxRange = Math.max(maxRange, Math.abs(tx), Math.abs(ty));
            });
            
            // æ£€æŸ¥ç‰¹å¾å‘é‡å˜æ¢åçš„ç‚¹
            if (eigenvectors.length > 0 && eigenvalues.length > 0 && typeof eigenvalues[0] === 'number') {
                eigenvectors.forEach((vector, index) => {
                    const [v1, v2] = vector;
                    const lambda = eigenvalues[index];
                    
                    // å˜æ¢åçš„ç‰¹å¾å‘é‡
                    const tx = matrix[0][0] * v1 + matrix[0][1] * v2;
                    const ty = matrix[1][0] * v1 + matrix[1][1] * v2;
                    
                    maxRange = Math.max(maxRange, Math.abs(tx), Math.abs(ty));
                });
            }
            
            // ç¡®ä¿è‡³å°‘è¿”å›1ï¼Œé¿å…é™¤ä»¥0
            return Math.max(maxRange, 1.0);
        }
        
        // éªŒè¯è¾“å…¥æ˜¯å¦ä¸ºæœ‰æ•ˆæ•°å­—
        function validateInput(value) {
            // å…è®¸ç©ºå­—ç¬¦ä¸²ï¼ˆä»¥ä¾¿ç”¨æˆ·åˆ é™¤å†…å®¹ï¼‰
            if (value === '') return false;
            
            // å»é™¤ç©ºæ ¼
            const trimmedValue = value.trim();
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºæœ‰æ•ˆæ•°å­—ï¼ˆæ”¯æŒå°æ•°å’Œè´Ÿæ•°ï¼‰
            const num = parseFloat(trimmedValue);
            if (isNaN(num)) return false;
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºæœ‰é™æ•°å­—
            if (!isFinite(num)) return false;
            
            return true;
        }
        
        // éªŒè¯æ‰€æœ‰çŸ©é˜µè¾“å…¥
        function validateAllInputs() {
            clearTimeout(validationTimeout);
            
            validationTimeout = setTimeout(() => {
                let allValid = true;
                let errorMessage = '';
                
                // æ£€æŸ¥æ¯ä¸ªè¾“å…¥æ¡†
                Object.entries(matrixInputs).forEach(([id, input]) => {
                    const value = input.value;
                    
                    if (value === '') {
                        input.classList.add('error');
                        allValid = false;
                        if (!errorMessage.includes('çŸ©é˜µå…ƒç´ ä¸èƒ½ä¸ºç©º')) {
                            errorMessage = 'çŸ©é˜µå…ƒç´ ä¸èƒ½ä¸ºç©º';
                        }
                    } else if (!validateInput(value)) {
                        input.classList.add('error');
                        allValid = false;
                        if (!errorMessage.includes('è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­—')) {
                            errorMessage = 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­—';
                        }
                    } else {
                        input.classList.remove('error');
                    }
                });
                
                // æ›´æ–°é”™è¯¯æ¶ˆæ¯
                matrixErrorEl.textContent = errorMessage;
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                generateBtn.disabled = !allValid;
                
                // æ›´æ–°å…¨å±€éªŒè¯çŠ¶æ€
                isValidInput = allValid;
                
                // å¦‚æœæ‰€æœ‰è¾“å…¥æœ‰æ•ˆä¸”å¯ç”¨äº†è‡ªåŠ¨æ›´æ–°ï¼Œåˆ™ç«‹å³æ›´æ–°å¯è§†åŒ–
                if (allValid && autoUpdateCheckbox.checked) {
                    generateTransform();
                }
            }, 300); // é˜²æŠ–å»¶è¿Ÿ
        }
        
        // è®¡ç®—ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡ (é’ˆå¯¹2x2çŸ©é˜µ)
        function computeEigen(matrix) {
            const a = matrix[0][0];
            const b = matrix[0][1];
            const c = matrix[1][0];
            const d = matrix[1][1];
            
            // è®¡ç®—ç‰¹å¾å€¼ï¼šÎ»Â² - (a+d)Î» + (ad - bc) = 0
            const trace = a + d;
            const determinant = a * d - b * c;
            
            const discriminant = trace * trace - 4 * determinant;
            
            // å¤æ•°ç‰¹å¾å€¼æƒ…å†µ
            if (discriminant < 0) {
                const realPart = trace / 2;
                const imagPart = Math.sqrt(-discriminant) / 2;
                
                eigenvalues = [
                    {real: realPart, imag: imagPart},
                    {real: realPart, imag: -imagPart}
                ];
                
                lambda1El.textContent = `${realPart.toFixed(2)} + ${imagPart.toFixed(2)}i`;
                lambda2El.textContent = `${realPart.toFixed(2)} - ${imagPart.toFixed(2)}i`;
                vector1El.textContent = "å¤æ•°ç‰¹å¾å‘é‡";
                vector2El.textContent = "å¤æ•°ç‰¹å¾å‘é‡";
                
                // éšè—ç¿»è½¬æç¤º
                flipNote1El.style.display = 'none';
                flipNote2El.style.display = 'none';
                
                // æ›´æ–°åŠ¨æ€è§£é‡Š
                updateDynamicExplanation(matrix, eigenvalues, []);
                
                return { eigenvalues, eigenvectors: [] };
            }
            
            // å®æ•°ç‰¹å¾å€¼
            const sqrtDisc = Math.sqrt(discriminant);
            eigenvalues = [
                (trace + sqrtDisc) / 2,
                (trace - sqrtDisc) / 2
            ];
            
            // æ›´æ–°ç‰¹å¾å€¼æ˜¾ç¤º
            lambda1El.textContent = eigenvalues[0].toFixed(2);
            lambda2El.textContent = eigenvalues[1].toFixed(2);
            
            // æ˜¾ç¤ºæˆ–éšè—ç¿»è½¬æç¤º
            flipNote1El.style.display = eigenvalues[0] < 0 ? 'block' : 'none';
            flipNote2El.style.display = eigenvalues[1] < 0 ? 'block' : 'none';
            
            // è®¡ç®—ç‰¹å¾å‘é‡
            eigenvectors = [];
            
            // å¯¹äºæ¯ä¸ªç‰¹å¾å€¼ï¼Œè§£ (A - Î»I)v = 0
            eigenvalues.forEach((lambda, index) => {
                // æ„é€ çŸ©é˜µ (A - Î»I)
                const aMinusLambda = a - lambda;
                const dMinusLambda = d - lambda;
                
                // è§£æ–¹ç¨‹ç»„ (a-Î»)x + b*y = 0, c*x + (d-Î»)y = 0
                // æˆ‘ä»¬éœ€è¦æ‰¾åˆ°éé›¶è§£
                let v1, v2;
                
                // æ–¹æ³•ï¼šå°è¯•æ‰¾åˆ°ä¸€ä¸ªéé›¶å‘é‡æ»¡è¶³æ–¹ç¨‹
                // é¦–å…ˆæ£€æŸ¥bæ˜¯å¦ä¸ä¸º0ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥è®¾x=1ï¼Œè§£å‡ºy
                if (Math.abs(b) > 1e-10) {
                    v1 = 1;
                    v2 = -aMinusLambda / b;
                } 
                // å¦‚æœbæ¥è¿‘0ä½†cä¸ä¸º0ï¼Œæˆ‘ä»¬å¯ä»¥è®¾y=1ï¼Œè§£å‡ºx
                else if (Math.abs(c) > 1e-10) {
                    v2 = 1;
                    v1 = -dMinusLambda / c;
                }
                // å¦‚æœbå’Œcéƒ½æ¥è¿‘0ï¼Œé‚£ä¹ˆçŸ©é˜µæ˜¯å¯¹è§’çŸ©é˜µ
                // æ£€æŸ¥(a-Î»)å’Œ(d-Î»)å“ªä¸ªä¸º0
                else if (Math.abs(aMinusLambda) < 1e-10) {
                    // (a-Î»)=0ï¼Œé‚£ä¹ˆxå¯ä»¥æ˜¯ä»»æ„å€¼ï¼Œy=0
                    v1 = 1;
                    v2 = 0;
                }
                else if (Math.abs(dMinusLambda) < 1e-10) {
                    // (d-Î»)=0ï¼Œé‚£ä¹ˆyå¯ä»¥æ˜¯ä»»æ„å€¼ï¼Œx=0
                    v1 = 0;
                    v2 = 1;
                }
                else {
                    // è¿™ç§æƒ…å†µä¸åº”è¯¥å‘ç”Ÿï¼Œä½†ä½œä¸ºåå¤‡æ–¹æ¡ˆ
                    v1 = 1;
                    v2 = 0;
                }
                
                // å½’ä¸€åŒ–
                const norm = Math.sqrt(v1 * v1 + v2 * v2);
                if (norm > 1e-10) {
                    v1 /= norm;
                    v2 /= norm;
                }
                
                eigenvectors.push([v1, v2]);
                
                // æ›´æ–°ç‰¹å¾å‘é‡æ˜¾ç¤º
                if (index === 0) {
                    vector1El.textContent = `[${v1.toFixed(3)}, ${v2.toFixed(3)}]`;
                } else {
                    vector2El.textContent = `[${v1.toFixed(3)}, ${v2.toFixed(3)}]`;
                }
            });
            
            // æ›´æ–°åŠ¨æ€è§£é‡Š
            updateDynamicExplanation(matrix, eigenvalues, eigenvectors);
            
            return { eigenvalues, eigenvectors };
        }
        
        // æ›´æ–°åŠ¨æ€è§£é‡Šå†…å®¹
        function updateDynamicExplanation(matrix, eigenvalues, eigenvectors) {
            // æ›´æ–°çŸ©é˜µæ˜¾ç¤º
            const matrixStr = `[[${matrix[0][0].toFixed(2)}, ${matrix[0][1].toFixed(2)}], [${matrix[1][0].toFixed(2)}, ${matrix[1][1].toFixed(2)}]]`;
            matrixDisplayEl.textContent = matrixStr;
            
            let explanationHTML = '';
            
            // å¤æ•°ç‰¹å¾å€¼æƒ…å†µ
            if (eigenvalues.length > 0 && eigenvalues[0].imag !== undefined) {
                const realPart = eigenvalues[0].real;
                const imagPart = eigenvalues[0].imag;
                
                explanationHTML = `
                    <p>å¯¹äºå½“å‰çŸ©é˜µ <span class="value-highlight">${matrixStr}</span>ï¼š</p>
                    <p>è¯¥çŸ©é˜µå…·æœ‰<span class="highlight">å¤æ•°ç‰¹å¾å€¼</span>ï¼š<span class="value-highlight">Î»â‚ = ${realPart.toFixed(2)} + ${imagPart.toFixed(2)}i</span> å’Œ <span class="value-highlight">Î»â‚‚ = ${realPart.toFixed(2)} - ${imagPart.toFixed(2)}i</span>ã€‚</p>
                    <p>å¤æ•°ç‰¹å¾å€¼è¡¨ç¤ºè¯¥çŸ©é˜µå˜æ¢åŒ…å«<span class="highlight">æ—‹è½¬</span>æˆåˆ†ã€‚åœ¨å˜æ¢ä¸­ï¼Œå‘é‡ä¸ä»…ä¼šç¼©æ”¾ï¼Œè¿˜ä¼šå‘ç”Ÿæ—‹è½¬ï¼Œå› æ­¤ä¸å­˜åœ¨ä¿æŒæ–¹å‘ä¸å˜çš„å®ç‰¹å¾å‘é‡ã€‚</p>
                    <p>ä»å¯è§†åŒ–ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå•ä½åœ†è¢«å˜æ¢ä¸ºä¸€ä¸ªæ—‹è½¬çš„æ¤­åœ†ï¼Œæ²¡æœ‰å®å‘é‡åœ¨å˜æ¢åä¿æŒåŸæ¥çš„æ–¹å‘ã€‚</p>
                `;
            } 
            // å®æ•°ç‰¹å¾å€¼æƒ…å†µ
            else if (eigenvalues.length > 0 && eigenvectors.length > 0) {
                const lambda1 = eigenvalues[0];
                const lambda2 = eigenvalues[1];
                const v1 = eigenvectors[0];
                const v2 = eigenvectors[1];
                
                // æ„å»ºç‰¹å¾å‘é‡å­—ç¬¦ä¸²
                const v1Str = `[${v1[0].toFixed(3)}, ${v1[1].toFixed(3)}]`;
                const v2Str = `[${v2[0].toFixed(3)}, ${v2[1].toFixed(3)}]`;
                
                // æè¿°ç¬¬ä¸€ä¸ªç‰¹å¾å‘é‡çš„è¡Œä¸º
                let eigen1Desc = '';
                if (Math.abs(lambda1) < 0.01) {
                    eigen1Desc = `<span class="highlight">vâ‚ = ${v1Str}</span> å¯¹åº”çš„ç‰¹å¾å€¼ <span class="value-highlight">Î»â‚ = ${lambda1.toFixed(2)}</span>ã€‚åœ¨çº¿æ€§å˜æ¢ä¸­ï¼Œæ²¿æ­¤æ–¹å‘çš„å‘é‡è¢«<span class="highlight">å‹ç¼©åˆ°åŸç‚¹</span>ï¼ˆé•¿åº¦ç¼©æ”¾ä¸º0ï¼‰ã€‚`;
                } else if (lambda1 > 0) {
                    const absLambda1 = Math.abs(lambda1);
                    eigen1Desc = `<span class="highlight">vâ‚ = ${v1Str}</span> å¯¹åº”çš„ç‰¹å¾å€¼ <span class="value-highlight">Î»â‚ = ${lambda1.toFixed(2)}</span>ã€‚åœ¨çº¿æ€§å˜æ¢ä¸­ï¼Œæ²¿æ­¤æ–¹å‘çš„å‘é‡<span class="highlight">ä¿æŒæ–¹å‘ä¸å˜</span>ï¼Œé•¿åº¦ç¼©æ”¾ä¸ºåŸæ¥çš„ <span class="value-highlight">${absLambda1.toFixed(2)}</span> å€${lambda1 > 1 ? 'ï¼ˆæ‹‰ä¼¸ï¼‰' : lambda1 < 1 ? 'ï¼ˆå‹ç¼©ï¼‰' : 'ï¼ˆä¸å˜ï¼‰'}ã€‚`;
                } else {
                    const absLambda1 = Math.abs(lambda1);
                    eigen1Desc = `<span class="highlight">vâ‚ = ${v1Str}</span> å¯¹åº”çš„ç‰¹å¾å€¼ <span class="value-highlight">Î»â‚ = ${lambda1.toFixed(2)}</span>ã€‚åœ¨çº¿æ€§å˜æ¢ä¸­ï¼Œæ²¿æ­¤æ–¹å‘çš„å‘é‡<span class="highlight">æ–¹å‘ç¿»è½¬</span>ï¼Œé•¿åº¦ç¼©æ”¾ä¸ºåŸæ¥çš„ <span class="value-highlight">${absLambda1.toFixed(2)}</span> å€${absLambda1 > 1 ? 'ï¼ˆæ‹‰ä¼¸å¹¶åå‘ï¼‰' : absLambda1 < 1 ? 'ï¼ˆå‹ç¼©å¹¶åå‘ï¼‰' : 'ï¼ˆä»…åå‘ï¼‰'}ã€‚`;
                }
                
                // æè¿°ç¬¬äºŒä¸ªç‰¹å¾å‘é‡çš„è¡Œä¸º
                let eigen2Desc = '';
                if (Math.abs(lambda2) < 0.01) {
                    eigen2Desc = `<span class="highlight">vâ‚‚ = ${v2Str}</span> å¯¹åº”çš„ç‰¹å¾å€¼ <span class="value-highlight">Î»â‚‚ = ${lambda2.toFixed(2)}</span>ã€‚åœ¨çº¿æ€§å˜æ¢ä¸­ï¼Œæ²¿æ­¤æ–¹å‘çš„å‘é‡è¢«<span class="highlight">å‹ç¼©åˆ°åŸç‚¹</span>ï¼ˆé•¿åº¦ç¼©æ”¾ä¸º0ï¼‰ã€‚`;
                } else if (lambda2 > 0) {
                    const absLambda2 = Math.abs(lambda2);
                    eigen2Desc = `<span class="highlight">vâ‚‚ = ${v2Str}</span> å¯¹åº”çš„ç‰¹å¾å€¼ <span class="value-highlight">Î»â‚‚ = ${lambda2.toFixed(2)}</span>ã€‚åœ¨çº¿æ€§å˜æ¢ä¸­ï¼Œæ²¿æ­¤æ–¹å‘çš„å‘é‡<span class="highlight">ä¿æŒæ–¹å‘ä¸å˜</span>ï¼Œé•¿åº¦ç¼©æ”¾ä¸ºåŸæ¥çš„ <span class="value-highlight">${absLambda2.toFixed(2)}</span> å€${lambda2 > 1 ? 'ï¼ˆæ‹‰ä¼¸ï¼‰' : lambda2 < 1 ? 'ï¼ˆå‹ç¼©ï¼‰' : 'ï¼ˆä¸å˜ï¼‰'}ã€‚`;
                } else {
                    const absLambda2 = Math.abs(lambda2);
                    eigen2Desc = `<span class="highlight">vâ‚‚ = ${v2Str}</span> å¯¹åº”çš„ç‰¹å¾å€¼ <span class="value-highlight">Î»â‚‚ = ${lambda2.toFixed(2)}</span>ã€‚åœ¨çº¿æ€§å˜æ¢ä¸­ï¼Œæ²¿æ­¤æ–¹å‘çš„å‘é‡<span class="highlight">æ–¹å‘ç¿»è½¬</span>ï¼Œé•¿åº¦ç¼©æ”¾ä¸ºåŸæ¥çš„ <span class="value-highlight">${absLambda2.toFixed(2)}</span> å€${absLambda2 > 1 ? 'ï¼ˆæ‹‰ä¼¸å¹¶åå‘ï¼‰' : absLambda2 < 1 ? 'ï¼ˆå‹ç¼©å¹¶åå‘ï¼‰' : 'ï¼ˆä»…åå‘ï¼‰'}ã€‚`;
                }
                
                // æ€»ç»“
                let summary = '';
                const negativeCount = eigenvalues.filter(val => val < 0).length;
                const zeroCount = eigenvalues.filter(val => Math.abs(val) < 0.01).length;
                const positiveCount = eigenvalues.length - negativeCount - zeroCount;
                
                if (zeroCount === 2) {
                    summary = `åœ¨è¿™ä¸ªå˜æ¢ä¸­ï¼Œä¸¤ä¸ªç‰¹å¾å‘é‡æ–¹å‘éƒ½è¢«å‹ç¼©åˆ°åŸç‚¹ï¼Œæ•´ä¸ªç©ºé—´è¢«å‹ç¼©åˆ°ä½ç»´ç©ºé—´ã€‚`;
                } else if (zeroCount === 1) {
                    summary = `åœ¨è¿™ä¸ªå˜æ¢ä¸­ï¼Œä¸€ä¸ªç‰¹å¾å‘é‡æ–¹å‘è¢«å‹ç¼©åˆ°åŸç‚¹ï¼Œå¦ä¸€ä¸ªæ–¹å‘${negativeCount === 1 ? 'ç¿»è½¬å¹¶' : ''}ç¼©æ”¾ã€‚å˜æ¢å°†å•ä½åœ†å‹ç¼©ä¸ºä¸€æ¡çº¿æ®µã€‚`;
                } else if (negativeCount === 2) {
                    summary = `åœ¨è¿™ä¸ªå˜æ¢ä¸­ï¼Œä¸¤ä¸ªç‰¹å¾å‘é‡æ–¹å‘éƒ½å‘ç”Ÿç¿»è½¬ï¼Œæ•´ä¸ªå˜æ¢ç›¸å½“äºå…ˆç¼©æ”¾å†å…³äºåŸç‚¹ä¸­å¿ƒå¯¹ç§°ã€‚`;
                } else if (negativeCount === 1) {
                    summary = `åœ¨è¿™ä¸ªå˜æ¢ä¸­ï¼Œä¸€ä¸ªç‰¹å¾å‘é‡æ–¹å‘ä¿æŒï¼Œå¦ä¸€ä¸ªæ–¹å‘ç¿»è½¬ã€‚å˜æ¢å°†å•ä½åœ†æ‹‰ä¼¸ä¸ºæ¤­åœ†ï¼Œä½†æœ‰ä¸€ä¸ªä¸»è½´æ–¹å‘å‘ç”Ÿç¿»è½¬ã€‚`;
                } else {
                    summary = `åœ¨è¿™ä¸ªå˜æ¢ä¸­ï¼Œä¸¤ä¸ªç‰¹å¾å‘é‡çš„æ–¹å‘å‡ä¿æŒä¸å˜ï¼Œå•ä½åœ†è¢«æ‹‰ä¼¸ä¸ºæ¤­åœ†ï¼Œä¸»è½´æ²¿ç‰¹å¾å‘é‡æ–¹å‘ã€‚`;
                }
                
                explanationHTML = `
                    <p>å¯¹äºå½“å‰çŸ©é˜µ <span class="value-highlight">${matrixStr}</span>ï¼š</p>
                    <p>${eigen1Desc}</p>
                    <p>${eigen2Desc}</p>
                    <p><span class="highlight">æ€»ç»“ï¼š</span>${summary} ç‰¹å¾å‘é‡æ˜¯å˜æ¢ä¸­ä¿æŒæ–¹å‘ä¸å˜çš„å‘é‡ï¼Œç‰¹å¾å€¼çš„ç»å¯¹å€¼è¡¨ç¤ºä¼¸ç¼©å€æ•°ï¼Œæ­£è´Ÿå·è¡¨ç¤ºæ–¹å‘æ˜¯å¦ç¿»è½¬ã€‚</p>
                `;
            }
            
            dynamicExplanationEl.innerHTML = explanationHTML;
        }
        
        // ç»˜åˆ¶åŸå§‹å›¾å½¢ï¼ˆå•ä½åœ†å’Œç½‘æ ¼ï¼‰
        function drawOriginal() {
            const ctx = originalCtx;
            const width = originalCanvas.width;
            const height = originalCanvas.height;
            const centerX = width / 2;
            const centerY = height / 2;
            
            // è®¡ç®—è‡ªé€‚åº”ç¼©æ”¾æ¯”ä¾‹
            const baseScale = Math.min(width, height) * 0.2;
            
            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, width, height);
            
            // ç»˜åˆ¶èƒŒæ™¯ç½‘æ ¼
            ctx.strokeStyle = '#f0f0f0';
            ctx.lineWidth = 1;
            const gridSize = 20;
            
            // å‚ç›´çº¿
            for (let x = 0; x < width; x += gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
                ctx.stroke();
            }
            
            // æ°´å¹³çº¿
            for (let y = 0; y < height; y += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }
            
            // ç»˜åˆ¶åæ ‡è½´
            ctx.strokeStyle = '#aaa';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(width, centerY);
            ctx.moveTo(centerX, 0);
            ctx.lineTo(centerX, height);
            ctx.stroke();
            
            // ç»˜åˆ¶å•ä½åœ†
            ctx.strokeStyle = '#3498db';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.arc(centerX, centerY, baseScale, 0, Math.PI * 2);
            ctx.stroke();
            
            // ç»˜åˆ¶æ­£æ–¹å½¢ç½‘æ ¼
            ctx.strokeStyle = '#2ecc71';
            ctx.lineWidth = 2;
            const squareSize = baseScale * 0.5;
            
            ctx.beginPath();
            ctx.rect(centerX - squareSize, centerY - squareSize, squareSize * 2, squareSize * 2);
            ctx.stroke();
            
            // ç»˜åˆ¶åŸå§‹ç‰¹å¾å‘é‡ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
            if (eigenvectors.length > 0 && eigenvectors[0].length > 0) {
                eigenvectors.forEach((vector, index) => {
                    const [v1, v2] = vector;
                    
                    // è®¾ç½®é¢œè‰²
                    const color = index === 0 ? '#e53e3e' : '#3182ce';
                    ctx.strokeStyle = color;
                    ctx.fillStyle = color;
                    ctx.lineWidth = 3;
                    
                    // åŸå§‹ç‰¹å¾å‘é‡
                    const arrowLength = baseScale * 0.8;
                    const endX = centerX + v1 * arrowLength;
                    const endY = centerY + v2 * arrowLength;
                    
                    // ç»˜åˆ¶ç®­å¤´
                    drawArrow(ctx, centerX, centerY, endX, endY);
                    
                    // æ ‡æ³¨ç‰¹å¾å‘é‡åç§°
                    ctx.font = 'bold 12px Arial';
                    ctx.fillText(`v${index+1}`, endX + 8 * (v1 > 0 ? 1 : -1), endY + 8 * (v2 > 0 ? 1 : -1));
                });
            }
            
            // æ ‡æ³¨åæ ‡è½´
            ctx.fillStyle = '#4a5568';
            ctx.font = '12px Arial';
            ctx.fillText('x', width - 10, centerY - 10);
            ctx.fillText('y', centerX + 10, 20);
            ctx.fillText('O', centerX + 10, centerY + 20);
        }
        
        // ç»˜åˆ¶å˜æ¢åçš„å›¾å½¢
        function drawTransformed(matrix) {
            const ctx = transformedCtx;
            const width = transformedCanvas.width;
            const height = transformedCanvas.height;
            const centerX = width / 2;
            const centerY = height / 2;
            
            // è®¡ç®—å˜æ¢å›¾å½¢çš„æœ€å¤§èŒƒå›´
            const maxRange = getTransformedRange(matrix);
            
            // è®¡ç®—è‡ªé€‚åº”ç¼©æ”¾æ¯”ä¾‹ï¼Œç¡®ä¿å›¾å½¢é€‚åˆç”»å¸ƒ
            const maxCanvasDimension = Math.min(width, height);
            const baseScale = (maxCanvasDimension * 0.2) / maxRange;
            
            // åº”ç”¨ç”¨æˆ·æ‰‹åŠ¨ç¼©æ”¾
            const finalScale = baseScale * transformedScale;
            
            // æ›´æ–°ç¼©æ”¾ä¿¡æ¯æ˜¾ç¤º
            transformedScaleInfo.textContent = `ç¼©æ”¾æ¯”ä¾‹: ${transformedScale.toFixed(1)}x`;
            
            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, width, height);
            
            // ç»˜åˆ¶èƒŒæ™¯ç½‘æ ¼
            ctx.strokeStyle = '#f0f0f0';
            ctx.lineWidth = 1;
            const gridSize = 20;
            
            // å‚ç›´çº¿
            for (let x = 0; x < width; x += gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
                ctx.stroke();
            }
            
            // æ°´å¹³çº¿
            for (let y = 0; y < height; y += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }
            
            // ç»˜åˆ¶åæ ‡è½´
            ctx.strokeStyle = '#aaa';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(width, centerY);
            ctx.moveTo(centerX, 0);
            ctx.lineTo(centerX, height);
            ctx.stroke();
            
            // ç”Ÿæˆå˜æ¢åçš„ç‚¹
            const circlePoints = 100;
            
            // ç»˜åˆ¶å˜æ¢åçš„å•ä½åœ†
            ctx.strokeStyle = '#3498db';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            for (let i = 0; i <= circlePoints; i++) {
                const angle = (i / circlePoints) * Math.PI * 2;
                const x = Math.cos(angle);
                const y = Math.sin(angle);
                
                // åº”ç”¨çŸ©é˜µå˜æ¢
                const tx = matrix[0][0] * x + matrix[0][1] * y;
                const ty = matrix[1][0] * x + matrix[1][1] * y;
                
                const canvasX = centerX + tx * finalScale;
                const canvasY = centerY + ty * finalScale;
                
                if (i === 0) {
                    ctx.moveTo(canvasX, canvasY);
                } else {
                    ctx.lineTo(canvasX, canvasY);
                }
            }
            
            ctx.closePath();
            ctx.stroke();
            
            // ç»˜åˆ¶å˜æ¢åçš„æ­£æ–¹å½¢
            ctx.strokeStyle = '#2ecc71';
            ctx.lineWidth = 2;
            
            const squarePoints = [
                [-0.5, -0.5],
                [0.5, -0.5],
                [0.5, 0.5],
                [-0.5, 0.5],
                [-0.5, -0.5]
            ];
            
            ctx.beginPath();
            
            squarePoints.forEach(([x, y], index) => {
                // åº”ç”¨çŸ©é˜µå˜æ¢
                const tx = matrix[0][0] * x + matrix[0][1] * y;
                const ty = matrix[1][0] * x + matrix[1][1] * y;
                
                const canvasX = centerX + tx * finalScale;
                const canvasY = centerY + ty * finalScale;
                
                if (index === 0) {
                    ctx.moveTo(canvasX, canvasY);
                } else {
                    ctx.lineTo(canvasX, canvasY);
                }
            });
            
            ctx.stroke();
            
            // ç»˜åˆ¶ç‰¹å¾å‘é‡ï¼ˆå¦‚æœå­˜åœ¨å®æ•°ç‰¹å¾å€¼ï¼‰
            if (eigenvectors.length > 0 && eigenvalues.length > 0 && typeof eigenvalues[0] === 'number') {
                eigenvectors.forEach((vector, index) => {
                    const [v1, v2] = vector;
                    const lambda = eigenvalues[index];
                    
                    // è®¾ç½®é¢œè‰²
                    const color = index === 0 ? '#e53e3e' : '#3182ce';
                    ctx.strokeStyle = color;
                    ctx.fillStyle = color;
                    ctx.lineWidth = 3;
                    
                    // åŸå§‹ç‰¹å¾å‘é‡
                    const arrowLength = finalScale * 0.8;
                    const endX = centerX + v1 * arrowLength;
                    const endY = centerY + v2 * arrowLength;
                    
                    // ç»˜åˆ¶åŸå§‹ç‰¹å¾å‘é‡ï¼ˆå®çº¿ï¼‰
                    drawArrow(ctx, centerX, centerY, endX, endY);
                    
                    // å˜æ¢åçš„ç‰¹å¾å‘é‡
                    // æ³¨æ„ï¼šA*v = Î»*vï¼Œæ‰€ä»¥å˜æ¢åçš„å‘é‡æ˜¯ Î»*v
                    const transformedLength = lambda * arrowLength;
                    const transformedEndX = centerX + v1 * transformedLength;
                    const transformedEndY = centerY + v2 * transformedLength;
                    
                    // ç»˜åˆ¶å˜æ¢åçš„å‘é‡ï¼ˆè™šçº¿ï¼‰
                    ctx.save();
                    ctx.strokeStyle = color;
                    ctx.setLineDash([5, 5]);
                    drawArrow(ctx, centerX, centerY, transformedEndX, transformedEndY);
                    ctx.restore();
                    
                    // æ ‡æ³¨ç‰¹å¾å€¼
                    ctx.font = 'bold 14px Arial';
                    const offsetX = 12 * (v1 > 0 ? 1 : -1);
                    const offsetY = 12 * (v2 > 0 ? 1 : -1);
                    
                    // å¦‚æœç‰¹å¾å€¼ä¸ºè´Ÿæ•°ï¼Œåœ¨æ ‡æ³¨ä¸­ç‰¹åˆ«è¯´æ˜
                    if (lambda < 0) {
                        ctx.fillStyle = '#d69e2e'; // ä½¿ç”¨æ©™è‰²è¡¨ç¤ºè´Ÿæ•°
                    }
                    
                    ctx.fillText(`Î»${index+1}=${lambda.toFixed(2)}`, 
                                transformedEndX + offsetX, 
                                transformedEndY + offsetY);
                    
                    // æ¢å¤é¢œè‰²
                    ctx.fillStyle = color;
                    
                    // æ ‡æ³¨ç‰¹å¾å‘é‡åç§°
                    ctx.font = 'bold 12px Arial';
                    ctx.fillText(`v${index+1}`, endX + offsetX/2, endY + offsetY/2);
                });
            } else if (eigenvalues.length > 0 && eigenvalues[0].imag) {
                // å¤æ•°ç‰¹å¾å€¼æƒ…å†µ
                ctx.fillStyle = '#e53e3e';
                ctx.font = 'bold 14px Arial';
                ctx.fillText('å¤æ•°ç‰¹å¾å€¼', centerX - 50, centerY + 80);
                ctx.fillText('æ— å®ç‰¹å¾å‘é‡', centerX - 60, centerY + 100);
            }
            
            // æ ‡æ³¨åæ ‡è½´
            ctx.fillStyle = '#4a5568';
            ctx.font = '12px Arial';
            ctx.fillText('x', width - 10, centerY - 10);
            ctx.fillText('y', centerX + 10, 20);
            ctx.fillText('O', centerX + 10, centerY + 20);
            
            // å¦‚æœç‰¹å¾å€¼ä¸ºè´Ÿï¼Œæ·»åŠ è¯´æ˜æ–‡æœ¬
            if (eigenvalues.length > 0 && typeof eigenvalues[0] === 'number') {
                const negativeCount = eigenvalues.filter(val => val < 0).length;
                if (negativeCount > 0) {
                    ctx.fillStyle = '#d69e2e';
                    ctx.font = 'bold 12px Arial';
                    ctx.fillText(`æœ‰${negativeCount}ä¸ªç‰¹å¾å€¼ä¸ºè´Ÿï¼Œæ–¹å‘ç¿»è½¬`, width - 150, height - 15);
                }
            }
            
            // å¦‚æœå›¾å½¢ç¼©æ”¾æ¯”ä¾‹ä¸ä¸º1ï¼Œæ·»åŠ ç¼©æ”¾æç¤º
            if (Math.abs(transformedScale - 1.0) > 0.1) {
                ctx.fillStyle = '#718096';
                ctx.font = 'bold 12px Arial';
                ctx.fillText(`å·²åº”ç”¨ç¼©æ”¾: ${transformedScale.toFixed(1)}x`, width - 120, 30);
            }
        }
        
        // ç»˜åˆ¶ç®­å¤´
        function drawArrow(ctx, fromX, fromY, toX, toY) {
            const headLength = 12;
            const dx = toX - fromX;
            const dy = toY - fromY;
            const angle = Math.atan2(dy, dx);
            
            // ç»˜åˆ¶çº¿
            ctx.beginPath();
            ctx.moveTo(fromX, fromY);
            ctx.lineTo(toX, toY);
            ctx.stroke();
            
            // ç»˜åˆ¶ç®­å¤´å¤´éƒ¨
            ctx.beginPath();
            ctx.moveTo(toX, toY);
            ctx.lineTo(toX - headLength * Math.cos(angle - Math.PI / 6), 
                      toY - headLength * Math.sin(angle - Math.PI / 6));
            ctx.moveTo(toX, toY);
            ctx.lineTo(toX - headLength * Math.cos(angle + Math.PI / 6), 
                      toY - headLength * Math.sin(angle + Math.PI / 6));
            ctx.stroke();
        }
        
        // ç”Ÿæˆå˜æ¢
        function generateTransform() {
            if (!isValidInput) {
                matrixErrorEl.textContent = 'è¯·è¾“å…¥æœ‰æ•ˆçš„çŸ©é˜µå€¼';
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨
            loadingIndicator.classList.add('active');
            
            // ä½¿ç”¨requestAnimationFrameç¡®ä¿UIä¸ä¼šå¡é¡¿
            requestAnimationFrame(() => {
                try {
                    // è·å–çŸ©é˜µè¾“å…¥å€¼
                    currentMatrix = [
                        [parseFloat(matrixInputs.a11.value) || 0, 
                         parseFloat(matrixInputs.a12.value) || 0],
                        [parseFloat(matrixInputs.a21.value) || 0, 
                         parseFloat(matrixInputs.a22.value) || 0]
                    ];
                    
                    // è®¡ç®—ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡
                    computeEigen(currentMatrix);
                    
                    // é‡æ–°ç»˜åˆ¶å›¾å½¢
                    drawOriginal();
                    drawTransformed(currentMatrix);
                    
                    // ä¿å­˜å½“å‰çŸ©é˜µ
                    window.currentMatrix = currentMatrix;
                    
                    // æ¸…é™¤é”™è¯¯æ¶ˆæ¯
                    matrixErrorEl.textContent = '';
                } catch (error) {
                    console.error('ç”Ÿæˆå˜æ¢æ—¶å‡ºé”™:', error);
                    matrixErrorEl.textContent = 'è®¡ç®—é”™è¯¯ï¼Œè¯·æ£€æŸ¥çŸ©é˜µè¾“å…¥';
                } finally {
                    // éšè—åŠ è½½æŒ‡ç¤ºå™¨
                    loadingIndicator.classList.remove('active');
                }
            });
        }
        
        // é‡ç½®çŸ©é˜µ
        function resetMatrix() {
            matrixInputs.a11.value = 2;
            matrixInputs.a12.value = 1;
            matrixInputs.a21.value = 1;
            matrixInputs.a22.value = 2;
            
            // éªŒè¯è¾“å…¥
            validateAllInputs();
            
            // ç”Ÿæˆå˜æ¢
            if (isValidInput) {
                generateTransform();
            }
        }
        
        // è®¾ç½®å¿«é€ŸçŸ©é˜µ
        function setQuickMatrix(matrixStr) {
            const values = matrixStr.split(',');
            if (values.length === 4) {
                matrixInputs.a11.value = values[0];
                matrixInputs.a12.value = values[1];
                matrixInputs.a21.value = values[2];
                matrixInputs.a22.value = values[3];
                
                // éªŒè¯è¾“å…¥
                validateAllInputs();
                
                // ç”Ÿæˆå˜æ¢
                if (isValidInput) {
                    generateTransform();
                }
            }
        }
        
        // ç¼©æ”¾æ§åˆ¶
        function zoomIn() {
            if (transformedScale < MAX_SCALE) {
                transformedScale += SCALE_STEP;
                if (window.currentMatrix) {
                    drawTransformed(window.currentMatrix);
                }
            }
        }
        
        function zoomOut() {
            if (transformedScale > MIN_SCALE) {
                transformedScale -= SCALE_STEP;
                if (window.currentMatrix) {
                    drawTransformed(window.currentMatrix);
                }
            }
        }
        
        function resetZoom() {
            transformedScale = 1.0;
            if (window.currentMatrix) {
                drawTransformed(window.currentMatrix);
            }
        }
        
        // åˆå§‹åŒ–
        function init() {
            // è®¾ç½®åˆå§‹Canvaså°ºå¯¸
            resizeCanvases();
            
            // åˆå§‹éªŒè¯
            validateAllInputs();
            
            // è®¡ç®—åˆå§‹ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡
            computeEigen(currentMatrix);
            
            // ç»˜åˆ¶åˆå§‹å›¾å½¢
            drawOriginal();
            drawTransformed(currentMatrix);
            
            // ä¿å­˜å½“å‰çŸ©é˜µ
            window.currentMatrix = currentMatrix;
            
            // äº‹ä»¶ç›‘å¬
            generateBtn.addEventListener('click', generateTransform);
            resetBtn.addEventListener('click', resetMatrix);
            
            // çª—å£å¤§å°å˜åŒ–æ—¶é‡æ–°è°ƒæ•´Canvas
            window.addEventListener('resize', resizeCanvases);
            
            // ä¸ºè¾“å…¥æ¡†æ·»åŠ è¾“å…¥äº‹ä»¶ç›‘å¬
            Object.values(matrixInputs).forEach(input => {
                input.addEventListener('input', validateAllInputs);
                
                // æ·»åŠ é”®ç›˜äº‹ä»¶ï¼Œæ”¯æŒå›è½¦é”®è§¦å‘å˜æ¢
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && isValidInput) {
                        generateTransform();
                    }
                });
                
                // æ·»åŠ ç„¦ç‚¹äº‹ä»¶ï¼Œæ¸…é™¤é”™è¯¯æ ·å¼
                input.addEventListener('focus', () => {
                    input.classList.remove('error');
                });
            });
            
            // è‡ªåŠ¨æ›´æ–°å¤é€‰æ¡†äº‹ä»¶
            autoUpdateCheckbox.addEventListener('change', () => {
                // å¦‚æœå¯ç”¨è‡ªåŠ¨æ›´æ–°ä¸”è¾“å…¥æœ‰æ•ˆï¼Œç«‹å³æ›´æ–°
                if (autoUpdateCheckbox.checked && isValidInput) {
                    generateTransform();
                }
            });
            
            // å¿«é€ŸçŸ©é˜µæŒ‰é’®äº‹ä»¶
            quickMatrixBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const matrixStr = btn.getAttribute('data-matrix');
                    setQuickMatrix(matrixStr);
                });
            });
            
            // ç¼©æ”¾æ§åˆ¶æŒ‰é’®äº‹ä»¶
            zoomInBtn.addEventListener('click', zoomIn);
            zoomOutBtn.addEventListener('click', zoomOut);
            resetZoomBtn.addEventListener('click', resetZoom);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', init);
    </script>
</body>
</html>